#!/bin/sh
#
# Synchronize passwords, keys etc. from atom to arm NVRAM
#

CP=/usr/local/bin/rpc_cp

dbfiles=`find /var/tmp/dropbear -type f -maxdepth 1`
sshfiles=`find /var/tmp/root-ssh -type f -maxdepth 1`
vpnfiles=`find /var/tmp/root-ssh/openvpn -type f -maxdepth 1`

# instruct arm to pull files. 
# They will only be copyied if they differ
#
rpc sh $CP /var/tmp/shadow /nvram/shadow

for f in $dbfiles; do
	rpc sh $CP $f /nvram/dropbear_x86
done

for f in $sshfiles; do
	rpc sh $CP $f /nvram/root-ssh_x86
done

for f in $vpnfiles; do
	rpc sh $CP $f /nvram/root-ssh_x86/openvpn
done
