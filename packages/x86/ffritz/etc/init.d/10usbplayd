#!/bin/sh
# Xfeature:getconfig
#
. /usr/local/etc/ffritz-env.sh || exit 1

if [ "x$1" = "xstop" ]; then
    ffdaemon -K usbplayd
    exit 0
fi

# Set default/user configuration
#
USBPLAYD_ARGS="-P /var/tmp/mpd.fifo:44100 -P /var/tmp/shairport.fifo:44100 -P /var/tmp/bt.fifo:44100"
test -z $2 || . $2

if [ "x$1" = "xgetconfig" ]; then
	echo
	echo "# Input pipes with input sample rate"
	echo "# Precedence is from left to right"
	echo
	echo 'USBPLAYD_ARGS="-P /var/tmp/mpd.fifo:44100 -P /var/tmp/shairport.fifo:44100 -P /var/tmp/bt.fifo:44100"'
	exit 0
fi


if [ "x$1" != "xstart" ]; then
	exit 0
fi

# Provide volume file upfront, the clients have no write access right to
# /var/tmp unless they run as root
#
if [ ! -f /var/tmp/volume ]; then
    echo 50 > /var/tmp/volume
fi
chmod 666 /var/tmp/volume

umask 0
ffdaemon $FFINSTDIR/bin/usbplayd -V /var/tmp/volume $USBPLAYD_ARGS
