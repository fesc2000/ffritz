#!/bin/sh
# Xfeature:getconfig
#
. /usr/local/etc/ffritz-env.sh || exit 1
. /usr/local/etc/mkusers || exit 1

if [ "x$1" = "xstop" ]; then
    ffdaemon -K shairport-sync
    exit 0
fi

if [ "x$1" = "xinfo" ]; then
	echo DAEMONS=shairport-sync
	exit 0
fi

if [ "x$1" != "xstart" ]; then
	exit 0
fi

# Make sure usbplayd runs
#
ffservice start usbplayd

# install default config file
#
if [ ! -r $NVRAM/etc/shairport-sync.conf ]; then
	cp $FFINSTDIR/etc/shairport-sync.conf.dfl $NVRAM/etc/shairport-sync.conf || exit 1
fi

# make sure mdns multicast responses go to the correct interface
#
ip route add 224.0.0.251/32 dev lan

# Run the shairport daemon
#
ffdaemon shairport-sync -u -c $NVRAM/etc/shairport-sync.conf
